#
# General stuff
###############################################################################

Set STRING_CONFIG_H_AUTHOR '"Dagoma"'

Set MOTHERBOARD BOARD_MKS_BASE
Enable CUSTOM_MACHINE_NAME
Set CUSTOM_MACHINE_NAME '"DiscoUltimate"'

#
# Temp stuff
###############################################################################

Set TEMP_SENSOR_0 17

Set TEMP_WINDOW 3
Set TEMP_BED_WINDOW 3

Set TEMP_RESIDENCY_TIME 15
Set TEMP_HYSTERESIS 4

Set DEFAULT_Kp 32.48
Set DEFAULT_Ki 6.4
Set DEFAULT_Kd 41.25

Set DEFAULT_bedKp 182.79
Set DEFAULT_bedKi 14.84
Set DEFAULT_bedKd 563.01

#
# Internal capabilities stuff
###############################################################################

Enable EEPROM_SETTINGS
Enable SDSUPPORT

Enable MIN_Z_HEIGHT_FOR_HOMING
Set MIN_Z_HEIGHT_FOR_HOMING 7

Enable Z_SAFE_HOMING

#Enable IS_MONO_FAN
#Set MONO_FAN_MIN_TEMP 50.0
#Set MONO_FAN_MAX_TEMP 150.0

Enable FAN_SOFT_PWM
Enable FAN_KICKSTART_TIME
Enable PRINTER_HEAD_EASY
Pin HEATER_1_PIN -1
Pin PRINTER_HEAD_EASY_CONSTANT_FAN_PIN 7
Set PRINTER_HEAD_EASY_CONSTANT_FAN_MIN_TEMP 50

Set DEFAULT_AXIS_STEPS_PER_UNIT '{80,80,2560,98}'
Set DEFAULT_MAX_FEEDRATE '{500, 500, 4, 170}'
Set DEFAULT_MAX_ACCELERATION '{3000,1000,20,10000}'
Set FILAMENT_CHANGE_E_FEEDRATE 66

Set DEFAULT_ACCELERATION 3000
Set DEFAULT_RETRACT_ACCELERATION 3000
Set DEFAULT_TRAVEL_ACCELERATION 3000

Set DEFAULT_XYJERK 20.0
Set DEFAULT_ZJERK 0.4
Set DEFAULT_EJERK 5.0

Enable USE_XMIN_PLUG
Disable USE_YMIN_PLUG
Enable USE_ZMIN_PLUG
Disable USE_XMAX_PLUG
Enable USE_YMAX_PLUG
Disable USE_ZMAX_PLUG

Set INVERT_X_DIR false
Set INVERT_Y_DIR false
Set INVERT_Z_DIR false

Set INVERT_E0_DIR false

Set X_HOME_DIR -1
Set Y_HOME_DIR 1
Set Z_HOME_DIR -1

Set X_MIN_POS 0
Set Y_MIN_POS 0
Set Z_MIN_POS 0
Set X_MAX_POS 205
Set Y_MAX_POS 205
Set Z_MAX_POS 205

Set Z_MIN_ENDSTOP_INVERTING true
Enable FIX_MOUNTED_PROBE
Enable AUTO_BED_LEVELING_FEATURE

Set X_PROBE_OFFSET_FROM_EXTRUDER 0
Set Y_PROBE_OFFSET_FROM_EXTRUDER 21
Set Z_PROBE_OFFSET_FROM_EXTRUDER 0

Set LEFT_PROBE_BED_POSITION 18
Set RIGHT_PROBE_BED_POSITION 182
Set FRONT_PROBE_BED_POSITION 58
Set BACK_PROBE_BED_POSITION 148

Enable NO_LCD_FOR_FILAMENTCHANGEABLE
Enable FILAMENTCHANGEENABLE
Disable AUTO_FILAMENT_CHANGE
Set FILAMENTCHANGE_XPOS 195
Set FILAMENTCHANGE_YPOS 195
Set FILAMENTCHANGE_FIRSTRETRACT -4.5
Set FILAMENTCHANGE_FINALRETRACT 0

# Pin re-attribution 1,2,3 style
Pin X_MAX_PIN -1
Pin X_MIN_PIN 2
Pin Y_MAX_PIN 3
Pin Y_MIN_MIN -1
Pin Z_MAX_PIN -1
Pin Z_MIN_PIN 15

#Enable USE_SECOND_SERIAL
#Set SECOND_SERIAL Serial1
#Set SECOND_SERIAL_BAUDRATE 115200

#Enable WIFI_PRINT

#
# LCD Stuff, even if not enabled
###############################################################################

Set PLA_PREHEAT_HPB_TEMP 60
Set ABS_PREHEAT_HPB_TEMP 90

Set LANGUAGE_INCLUDE 'GENERATE_LANGUAGE_INCLUDE(fr_utf8)'

#Set SUMMON_PRINT_PAUSE_SCRIPT '"M600 U-55 X55 Y-92 Z60"'
#Set HEATING_STOP_TIME
#Set HEATING_STOP_TIME 600000UL
#Set FILAMENT_PRE_INSERTION_LENGTH 40
#Set FILAMENT_PRE_INSERTION_FEEDRATE_FACTOR 0.1
#Set FILAMENT_AUTO_INSERTION_FINAL_FEEDRATE_FACTOR 0.01
#Set FILAMENTCHANGE_TEMPERATURE 200
#Set FILAMENTCHANGE_DELTA_Z_DOME_SECURITY_DISTANCE 25.0
#TO REMOVE Set FILAMENTCHANGE_FEEDRATE_MULTIPLICATOR 5.0
#Set FILAMENTCHANGE_Z_HOP_MM 10.0
#TO RENAME : FILAMENT_SUCTION_GAP
#Set FILAMENT_AUTO_INSERTION_GAP 150
#Set FILAMENT_AUTO_INSERTION_VERIFICATION_LENGTH_MM 2.0
#Set FILAMENT_RUNOUT_SCRIPT '"M600 U-55 X55 Y-92 Z60"'


Set FILAMENTCHANGE_TEMPERATURE 200
Set FILAMENTCHANGE_Z_HOP_MM 10.0
Set HEATING_STOP_TIME 600000UL

Set DEFAULT_AXIS_STEPS_PER_UNIT '{160,160,1600,196}'

Enable DAC_STEPPER_CURRENT

Set DAC_STEPPER_ORDER '{0,1,2,3}'

Set DAC_STEPPER_SENSE 0.11
Set DAC_STEPPER_ADDRESS 0
Set DAC_STEPPER_MAX 3520
# Internal Vref, gain 1x = 2.048V
Set DAC_STEPPER_VREF 1
Set DAC_STEPPER_GAIN 0



# To support a FINAL_RETRACT longer than 400 (200+200)
Disable PREVENT_LENGTHY_EXTRUDE

# Flag to activate for emergency stop
Enable EMERGENCY_STOP
Enable EMERGENCY_STOP_Z_MOVE

# FLag to enable leveling debugging
#Enable DEBUG_LEVELING_FEATURE


# D19 is Z+
# Sensor PIN : D19
Enable FILAMENT_RUNOUT_SENSOR
Pin FILRUNOUT_PIN 39
Set FIL_RUNOUT_INVERTING true
Set FILAMENT_RUNOUT_SCRIPT '"M600 I-1 U5 V195 X195 Y195"'


Enable AUTO_FILAMENT_CHANGE
Set FILAMENTCHANGE_FIRSTRETRACT -4.5
Set FILAMENTCHANGE_FINALRETRACT -950

Set FILAMENTCHANGE_AUTO_INSERTION_PURGE_LENGTH 30
Set FILAMENTCHANGE_AUTO_INSERTION_VERIFICATION_LENGTH_MM 0.5
Set FILAMENTCHANGE_AUTO_INSERTION_PURGE_FEEDRATE_FACTOR 0.05
Set FILAMENTCHANGE_AUTO_INSERTION_CONFIRMATION_LENGTH 40
Set FILAMENTCHANGE_AUTO_INSERTION_PREAMBLE_FEEDRATE_FACTOR 0.25
Set FILAMENTCHANGE_INSERTION_SCRIPT '"M600 I1 U5 V195 X195 Y195"'
Set FILAMENTCHANGE_EXTRACTION_SCRIPT '"M600 I-1 U5 V195 X195 Y195"'

# D18 is Z-
# Button PIN : D18
Enable SUMMON_PRINT_PAUSE
Pin SUMMON_PRINT_PAUSE_PIN 32
Set SUMMON_PRINT_PAUSE_INVERTING true
Set SUMMON_PRINT_PAUSE_SCRIPT '"M600 U5 V195 X195 Y195"'

Enable ONE_BUTTON
Pin ONE_BUTTON_PIN	SUMMON_PRINT_PAUSE_PIN
Set ONE_BUTTON_INVERTING true

#Set HEATING_STOP_TIME 600000UL
#Set FILAMENT_PRE_INSERTION_LENGTH 40
#Set FILAMENT_PRE_INSERTION_FEEDRATE_FACTOR 0.1
#Set FILAMENT_AUTO_INSERTION_FINAL_FEEDRATE_FACTOR 0.01
#Set FILAMENTCHANGE_TEMPERATURE 200
#Set FILAMENTCHANGE_DELTA_Z_DOME_SECURITY_DISTANCE 25.0
##TO REMOVE Set FILAMENTCHANGE_FEEDRATE_MULTIPLICATOR 5.0
#Set FILAMENTCHANGE_Z_HOP_MM 10.0
##TO RENAME : FILAMENT_SUCTION_GAP
#Set FILAMENT_AUTO_INSERTION_GAP 150
#Set FILAMENT_AUTO_INSERTION_VERIFICATION_LENGTH_MM 2.0
#Set FILAMENT_RUNOUT_SCRIPT '"M600 U-55 X55 Y-92 Z60"'

# Increase buffers size
Set BLOCK_BUFFER_SIZE 64
Set BUFSIZE 16

# Stuff to clean the nozzle before ejection
Set RETRACT_BEFORE_EJECTION 4
Set EXTRUDE_BEFORE_EJECTION 1.5
Set QUICK_PAUSE_TIMEOUT 2000
